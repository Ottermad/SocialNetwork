<script>
    $(".comment-button").on("click", function() {
        var id = $(this).attr("id");
        var comment = $(".input" + id ).val();
        var csrfToken = document.getElementById("csrf_token").value;

        // Create a new variable to hold request
        var commentRequest;

        // Check if XMLHttpRequest exists (modern browsers - IE7+, Firefox, Chrome, Opera, Safari)
        if (window.XMLHttpRequest) {
            // if it does create a XMLHttpRequest
            commentRequest = new XMLHttpRequest();
        }
        else {
            // otherwise deal with IE6, IE5
            commentRequest=new ActiveXObject("Microsoft.XMLHTTP");
        }

        // Call back function for request
        commentRequest.onreadystatechange=function() {

            console.log(commentRequest.status);

            // Check if request was sent successfully.
            if (commentRequest.readyState==4 && commentRequest.status==200) {

                // Get response body
                var response = commentRequest.responseText;
                alert(response);
                getSinglePost(id);
            }
        }

        // Send a post request
        commentRequest.open("POST","{{ url_for("comment") }}",true);
        commentRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded");
        commentRequest.send("comment=" + comment + "&post_id=" + id + "&csrf_token=" + csrfToken);
    });

    function getSinglePost(id) {
        // Create a new variable to hold request
        var commentRequest;

        // Check if XMLHttpRequest exists (modern browsers - IE7+, Firefox, Chrome, Opera, Safari)
        if (window.XMLHttpRequest) {
            // if it does create a XMLHttpRequest
            commentRequest = new XMLHttpRequest();
        }
        else {
            // otherwise deal with IE6, IE5
            commentRequest=new ActiveXObject("Microsoft.XMLHTTP");
        }

        // Call back function for request
        commentRequest.onreadystatechange=function() {

            console.log(commentRequest.status);

            // Check if request was sent successfully.
            if (commentRequest.readyState==4 && commentRequest.status==200) {

                // Get response body
                var json = commentRequest.responseText;
                var json = JSON.parse(json);
                var postHTML = "";
                postHTML += '<p class="name">' + json[0] + '</p>';
                postHTML += '<p class="timestamp">' + json[1] + '</p>';
                postHTML += '<p class="content">' + json[2] + '</p>';
                postHTML += '<div>';
                postHTML += '<ul>';
                for(var c = 0; c < json[3].length; c++) {
                    postHTML += '<li>' + json[3][c][0] + ': ' + json[3][c][2] + ' @ ' +  json[3][c][1] + '</li>';
                }
                postHTML += ' </ul>';
                postHTML += '</div>';

                postHTML += '<form>';
                postHTML += '<input class="input' + json[4] + '" name="comment" type="text">';
                postHTML +='<button type="button" id="' + json[4] + '" class="comment-button">Comment</button>';
                postHTML += '</form>';
                $("#div" + id).html(postHTML);
            }
        }

        // Send a post request
        commentRequest.open("POST","{{ url_for("get_post") }}",true);
        commentRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded");
        commentRequest.send("id=" + id);
    }
</script>