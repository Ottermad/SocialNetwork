{% from "macros.html" import render_field %}
{% extends "layout.html" %}
{% block css %}
    <link rel="stylesheet" type="text/css" href="{{ url_for("static", filename="css/wmd.css") }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for("static", filename="css/posts.css") }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for("static", filename="css/font-awesome.css") }}">
{% endblock %}
{% block content %}

    <div class="right friends-bar theme-box">
        <h1 class="theme-font">Friends: </h1>
        <ul class="friends-list" id="people">

        </ul>
        <div class="conversation bg-white" id="Bill">
            <h3 id="name"></h3>
            <div class="messages-box">
                <ul id="messages">

                </ul>
            </div>
            <div id="messagingForm">
                <form method="post">
                    {{ messaging_form.hidden_tag() }}
                    {% for field in messaging_form %}
                        {{ render_field(field) }}
                    {% endfor %}
                    <button type="button" id="send-message" onclick="sendMessage()">Send</button>
                </form>
            </div>
        </div>
    </div>

    <div class="left main-content">
        <h1 class="theme-font" style="font-weight: 700;">Welcome to Fakebook</h1>
        <h2 class="theme-font"> Make a new post: </h2>

        <!--Editor Widget-->
        <div class="pad-5">
            <div id="button-bar-overlay">
                <i class="fa fa-bold fa-2x" emulate="#wmd-bold-button" title="Bold"></i> 
                <i class="fa fa-5x"></i>
                <i class="fa fa-italic fa-2x" emulate="#wmd-italic-button"></i>
                <i class="fa fa-5x"></i> <i class="fa fa-5x"></i> <i class="fa fa-5x"></i><!--Seperator -->
                <i class="fa fa-5x"></i> <i class="fa fa-5x"></i> <i class="fa fa-5x"></i><!--Seperator -->
                <i class="fa fa-link fa-2x" emulate="#wmd-link-button"></i>
                <i class="fa fa-5x"></i>
                <i class="fa fa-quote-left fa-2x" emulate="#wmd-quote-button"></i>
                <i class="fa fa-5x"></i>
                <i class="fa fa-code fa-2x" emulate="#wmd-code-button"></i>
                <i class="fa fa-5x"></i>
                <i class="fa fa-picture-o fa-2x" emulate="#wmd-image-button"></i>
                <i class="fa fa-5x"></i> <i class="fa fa-5x"></i> <i class="fa fa-5x"></i><!--Seperator -->
                <i class="fa fa-5x"></i> <i class="fa fa-5x"></i> <i class="fa fa-5x"></i><!--Seperator -->
                <i class="fa fa-list-ol fa-2x" emulate="#wmd-olist-button"></i>
                <i class="fa fa-5x"></i>
                <i class="fa fa-list-ul fa-2x" emulate="#wmd-ulist-button"></i>
                <i class="fa fa-5x"></i>
                <i class="fa fa-header fa-2x" emulate="#wmd-heading-button"></i>
                <i class="fa fa-5x"></i>
                <i class="fa fa-minus fa-2x" emulate="#wmd-hr-button"></i>
                <i class="fa fa-5x"></i> <i class="fa fa-5x"></i> <i class="fa fa-5x"></i><!--Seperator -->
                <i class="fa fa-5x"></i> <i class="fa fa-5x"></i> <i class="fa fa-5x"></i><!--Seperator -->
                <i class="fa fa-5x"></i>
                <i class="fa fa-undo fa-2x" emulate="#wmd-undo-button"></i>
                <i class="fa fa-5x"></i>
                <i class="fa fa-repeat fa-2x" emulate="#wmd-redo-button"></i>
                <!--preveiw button-->
                <i class="fa fa-eye fa-2x right" id="preview-toggle" title="Toggle preview"></i>
            </div>

            <div id="wmd-button-bar"></div>
            <form method="post">
                {{ post_form.hidden_tag() }}
                {% for field in post_form %}
                    {{ render_field(field) }}
                {% endfor %}
                <button type="button" id="submit-post" onclick="sendPost()">Submit Post</button>
            </form>
            <div id="wmd-preview" class="theme-font theme-box pad-5"></div>
        </div>

        <!-- List all of the posts -->
        <div id="posts pad-5" class="theme-font">
            {% for post in posts %}
                <div class="post theme-box" id="div{{ post[4] }}">
                    <p class="name dark-gray">By {{ post[0] }} at <span class="timestamp">{{ post[1] }}</span></p>
                    <div class="content">{{ post[2] | safe }}</div>
                    <div>
                        <h2 class="comment-header">Comments:</h2>
                        <hr class="comment-section-seperator"> <!-- Comment and post divider -->
                        <ul class="comment-list">
                            {% for comment in post[3] %}
                                <li class="comment"><span class="comment-name">{{ comment[0] }}</span>: {{ comment[2] }} <span class="date right">{{ comment[1] }}</span></li>
                                <hr class="comment-seperator">
                            {%  endfor %}
                        </ul>
                    </div>
                    <form>
                        <input class="input{{ post[4] }} comment-input" name="comment" type="text">
                        <button type="button" id="{{ post[4] }}" class="comment-button"><i class="fa fa-comment"></i> Post comment</button>
                    </form>
                    <hr class="comment-section-seperator">
                </div>
            {% endfor %}
        </div>
        <button type="button" id="load-posts" onclick="getPosts()">Load More</button>
    </div>


{% endblock %}
{% block ajax %}
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pagedown/1.0/Markdown.Converter.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pagedown/1.0/Markdown.Editor.js"></script>
    <script type="text/javascript" src="{{ url_for("static", filename="js/markdown-editor-widget.js") }}"></script>
    <script type="text/javascript">
                jQuery(document).ready(function($) {
                    $('.fa').click(function(event) {
                        //event.preventDefault();
                        var emulateIdentitifier = $(this).attr('emulate');
                        console.log(emulateIdentitifier);
                        if ($(emulateIdentitifier)) {
                            $(emulateIdentitifier).click();
                        }
                    });
                });
            </script>
    {% include "send_message.html" %}
    {% include "get_messages.html" %}
    {% include "send_post.html" %}
    {% include "get_posts.html" %}
    {% include "add_comment.html" %}
    <script type="text/javascript">

        var currentPerson = "";
        function auto_update () {

            if (currentPerson != "") {
                getConversation(currentPerson);
            }

            setTimeout(auto_update, 10000);
        }
        getPeople();
        auto_update();

    </script>

{% endblock %}