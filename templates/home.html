{% from "macros.html" import render_field %}
{% extends "layout.html" %}
{% block css %}
    <link rel="stylesheet" type="text/css" href="{{ url_for("static", filename="css/wmd.css") }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for("static", filename="css/posts.css") }}">
{% endblock %}
{% block content %}

    <div class="right friends-bar theme-box">
        <h1 class="theme-font">Friends: </h1>
        <ul class="friends-list" id="people">

        </ul>
        <div class="conversation bg-white" id="Bill">
            <h3 id="name"></h3>
            <div class="messages-box">
                <ul id="messages">

                </ul>
            </div>
            <div id="messagingForm">
                <form method="post">
                    {{ messaging_form.hidden_tag() }}
                    {% for field in messaging_form %}
                        {{ render_field(field) }}
                    {% endfor %}
                    <button type="button" id="send-message" onclick="sendMessage()">Send</button>
                </form>
            </div>
        </div>
    </div>

    <div class="left main-content">
        <h1 class="theme-font" style="font-weight: 700;">Welcome to Fakebook</h1>
        <h2 class="theme-font"> Make a new post: </h2>

        <!--Editor Widget-->
        <div class="pad-5">
            <div id="wmd-button-bar"></div>
            <button id="preview-toggle">Toggle Preview</button>
            <form method="post">
                {{ post_form.hidden_tag() }}
                {% for field in post_form %}
                    {{ render_field(field) }}
                {% endfor %}
                <button type="button" id="submit-post" onclick="sendPost()">Submit Post</button>
            </form>
            <div id="wmd-preview" class="theme-font theme-box pad-5"></div>
        </div>

        <!-- List all of the posts -->
        <div id="posts" class="theme-font">
            {% for post in posts %}
                <div class="post theme-box">
                    <p class="name dark-gray">By {{ post[0] }} at <span class="timestamp">{{ post[1] }}</span></p>
                    <div class="content">{{ post[2] | safe }}</div>
                    <div>
                        <h2 class="comment-header">Comments:</h2>
                        <hr class="comment-seperator"> <!-- Comment and post divider -->
                        <ul class="comment-list">
                            {% for comment in post[3] %}
                                <li class="comment"><span class="comment-name">{{ comment[0] }}</span>: {{ comment[2] }} <span class="date right">{{ comment[1] }}</span></li>
                                <hr class="comment-seperator">
                            {%  endfor %}
                        </ul>
                    </div>
                    <form>
                        <input class="input{{ post[4] }}" name="comment" type="text">
                        <button type="button" id="{{ post[4] }}" class="comment-button">Comment</button>
                    </form>
                    <hr class="comment-seperator">
                </div>
            {% endfor %}
            <button type="button" id="load-posts" onclick="getPosts()">Load More</button>
        </div>
    </div>


{% endblock %}
{% block ajax %}
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pagedown/1.0/Markdown.Converter.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pagedown/1.0/Markdown.Editor.js"></script>
    <script type="text/javascript" src="{{ url_for("static", filename="js/markdown-editor-widget.js") }}"></script>
    {% include "send_message.html" %}
    {% include "get_messages.html" %}
    {% include "send_post.html" %}
    {% include "get_posts.html" %}
    {% include "add_comment.html" %}
    <script type="text/javascript">

        var currentPerson = "";
        function auto_update () {

            if (currentPerson != "") {
                getConversation(currentPerson);
            }

            setTimeout(auto_update, 10000);
        }
        getPeople();
        auto_update();

    </script>

{% endblock %}