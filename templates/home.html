{% from "macros.html" import render_field %}
{% extends "layout.html" %}
{% block content %}

    <div class="right friends-bar theme-box">
        <h1 class="theme-font">Friends: </h1>
        <ul class="friends-list" id="people">

        </ul>
        <div class="conversation bg-white" id="Bill">
            <h3>Bill</h3>
            <div class="messages-box">
                <div class="message"> <span class="date">26/05/15: 13:05</span> - Test Message </div>
            </div>
        </div>
        <script type="text/javascript">
            //Handle messages
            //assuming messages are requested per 'friend'
            /*
            var janeMessages = {
                messages = [
                    {
                        date
                    }
                ]
            };*/
        </script>

    </div>




























    <div id="postForm">
        <form method="post">
            {{ post_form.hidden_tag() }}
            {% for field in post_form %}
                {{ render_field(field) }}
            {% endfor %}
            <button type="button" id="submit-post" onclick="sendPost()">Submit Post</button>
        </form>
    </div>
    <div id="posts">
        {% for post in posts %}
            <div class="post">
                <p class="name">{{ post[0] }}</p>
                <p class="timestamp">{{ post[1] }}</p>
                <div class="content">{{ post[2] }}</div>
                <div>
                    <ul>
                        {% for comment in post[3] %}
                            <li>{{ comment[0] }}: {{ comment[2] }} @ {{ comment[1] }}</li>
                        {%  endfor %}
                    </ul>
                </div>
                <form>
                    <input class="input{{ post[4] }}" name="comment" type="text">
                    <button type="button" id="{{ post[4] }}" class="comment-button">Comment</button>
                </form>
            </div>
        {% endfor %}
        <button type="button" id="load-posts" onclick="getPosts()">Load More</button>
    </div>
    <div id="messagingForm">
        <form method="post">
            {{ messaging_form.hidden_tag() }}
            {% for field in messaging_form %}
                {{ render_field(field) }}
            {% endfor %}
            <button type="button" id="send-message" onclick="sendMessage()">Send</button>
        </form>
    </div>
    <div>
        <ul id="people">

        </ul>
        <ul id="messages">

        </ul>
    </div>
{% endblock %}
{% block ajax %}
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pagedown/1.0/Markdown.Converter.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pagedown/1.0/Markdown.Editor.js"></script>
    <script type="text/javascript" src="js/markdown-editor-widget.js"></script>
    {% include "send_message.html" %}
    {% include "get_messages.html" %}
    {% include "send_post.html" %}
    {% include "get_posts.html" %}
    {% include "add_comment.html" %}
    <script type="text/javascript">

        var currentPerson = "";
        function auto_update () {

            if (currentPerson != "") {
                getConversation(currentPerson);
            }

            setTimeout(auto_update, 10000);
        }
        getPeople();
        auto_update();



    </script>

{% endblock %}